---
- name: "Deploy WP site"
  hosts: web
  remote_user: vagrant
  gather_facts: False

  vars:
    user: "{{ wordpress_sites[site].user }}"
    group: "{{ wordpress_sites[site].group }}"
    deploy_to: "{{ www_root }}/{{ site }}"

  roles:
    -
      role: nicolai86.prepare-release

      repo: "{{ wordpress_sites[site].repo }}"
      branch: "{{ branch | default('master') }}"

      symlinks:
        - { src: "{{ shared_path }}/log", dest: "{{ build_path }}/log" }
        - { src: "{{ shared_path }}/.env", dest: "{{ build_path }}/.env" }

      tags: deploy

    -
      role: wordpress-deploy
      tags: deploy

    -
      role: nicolai86.finalize-release
      tags: deploy
