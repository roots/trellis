wordpress_env_defaults:
  db_host: localhost
  db_name: "{{ site | underscore }}_{{ env }}"
  db_user: "{{ site | underscore }}"
  disable_wp_cron: true
  wp_env: "{{ env }}"
  wp_home: "{{ project.ssl.enabled | default(false) | ternary('https', 'http') }}://{{ project.site_hosts | map(attribute='canonical') | first }}"
  wp_siteurl: "{{ project.ssl.enabled | default(false) | ternary('https', 'http') }}://{{ project.site_hosts | map(attribute='canonical') | first }}/wp"
  domain_current_site: "{{ project.site_hosts | map(attribute='canonical') | first }}"
  git_sha: "{{ git_clone.after }}"
  release_version: "{{ deploy_helper.new_release }}"
  wp_debug_log: "{{ project_root }}/logs/debug.log"
  wp_post_revisions: true

# Redis cache environment variables for deployment
deploy_redis_cache_env:
  wp_redis_host: "{{ project.object_cache.host | default('127.0.0.1') }}"
  wp_redis_port: "{{ project.object_cache.port | default(6379) }}"
  wp_redis_database: "{{ project.object_cache.database | default(0) }}"
  wp_redis_prefix: "{{ project.object_cache.prefix | default(site | underscore + '_') }}"
  wp_cache_key_salt: "{{ site }}_{{ env }}"

# Memcached cache environment variables for deployment
deploy_memcached_cache_env:
  wp_memcached_host: "{{ project.object_cache.host | default('127.0.0.1') }}"
  wp_memcached_port: "{{ project.object_cache.port | default(11211) }}"
  wp_memcached_prefix: "{{ project.object_cache.prefix | default(site | underscore + '_') }}"
  wp_cache_key_salt: "{{ site }}_{{ env }}"

site_env: "{{ wordpress_env_defaults | combine(vault_wordpress_env_defaults | default({}), deploy_object_cache_enabled_redis | ternary(deploy_redis_cache_env, {}), deploy_object_cache_enabled_memcached | ternary(deploy_memcached_cache_env, {}), project.env | default({}), vault_wordpress_sites[site].env) }}"

# Helper variables for deploy object cache conditions
deploy_object_cache_enabled_redis: "{{ project.object_cache.enabled | default(false) and project.object_cache.provider | default('') == 'redis' }}"
deploy_object_cache_enabled_memcached: "{{ project.object_cache.enabled | default(false) and project.object_cache.provider | default('') == 'memcached' }}"
